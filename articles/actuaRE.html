<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="actuaRE">
<title>Introduction to actuaRE • actuaRE</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to actuaRE">
<meta property="og:description" content="actuaRE">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">actuaRE</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item">
  <a class="nav-link" href="../articles/actuaRE.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Introduction to actuaRE</h1>
                        <h4 data-toc-skip class="author">Bavo DC Campo</h4>
            
            <h4 data-toc-skip class="date">2022-07-04</h4>
      
      
      <div class="d-none name"><code>actuaRE.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="handling-hierarchically-multi-level-factors-using-random-effects-models">Handling hierarchically multi-level factors using random effects models<a class="anchor" aria-label="anchor" href="#handling-hierarchically-multi-level-factors-using-random-effects-models"></a>
</h2>
<p>Multi-level factors (MLFs) are nominal variables with too many levels for ordinary generalized linear model (GLM) estimation <span class="citation">(Ohlsson and Johansson 2010)</span>. Within the machine learning literature, these type of risk factors are better known as high-cardinality attributes <span class="citation">(Micci-Barreca 2001)</span>. This package focuses on MLFs that exhibit a hierarchical structure and a typical example hereof, within workers’ compensation insurance, is the NACE code. In our illustration, we work with a hierarchical MLF that has two hierarchical levels: industry and branch. Figure 1 visualizes this hierarchical structure with a hypothetical example.</p>
<div class="figure" style="text-align: center">
<p class="caption">
Figure 1: Hierarchical structure of a hypothetical example
</p>
<img src="HierarchicalStructureAdj.png" alt="Figure 1: Hierarchical structure of a hypothetical example" width="358">
</div>
<div class="section level3">
<h3 id="which-random-effects-models-can-we-fit-using-actuare">Which random effects models can we fit using actuaRE?<a class="anchor" aria-label="anchor" href="#which-random-effects-models-can-we-fit-using-actuare"></a>
</h3>
<p>With the current version of the <code>actuaRE</code> package, you are able to fit random effects models with the following functional form</p>
<p><span class="math display">\[\begin{align*}
g(E[Y_{ijkt} | U_j, U_{jk}]) &amp;= \mu + \boldsymbol{x}_{ijkt}^\top \boldsymbol{\beta} + U_j + U_{jk} \\&amp;= \zeta_{ijkt}.\\
\end{align*}\]</span></p>
<p>Here, <span class="math inline">\(Y_{ijkt}\)</span> denotes the loss cost of risk profile <span class="math inline">\(i\)</span> (based on the company-specific risk factors) operating in branch <span class="math inline">\(k\)</span> within industry <span class="math inline">\(j\)</span> at time <span class="math inline">\(t\)</span>. We calculate the loss cost as</p>
<p><span class="math display">\[\begin{align*}
  Y_{ijkt} = \frac{Z_{ijkt}}{w_{ijkt}}
\end{align*}\]</span> where <span class="math inline">\(Z_{ijkt}\)</span> denotes the total claim cost and <span class="math inline">\(w_{ijkt}\)</span> is an appropriate volume measure. <span class="math inline">\(g(\cdot)\)</span> denotes the link function (for example the identity or log link), <span class="math inline">\(\mu\)</span> the intercept, <span class="math inline">\(\boldsymbol{x}_{ijkt}\)</span> the company-specific covariate vector and <span class="math inline">\(\boldsymbol{\beta}\)</span> the corresponding parameter vector. With the model parameters <span class="math inline">\(\mu\)</span> and <span class="math inline">\(\boldsymbol{\beta}\)</span> we capture the company-specific effects. To assess the effect of the hierarchical MLF, we introduce the random effects <span class="math inline">\(U_j\)</span> and <span class="math inline">\(U_{jk}\)</span> which capture the unobservable effects of the industry and the branch in which the company operates. <span class="math inline">\(U_j\)</span> denotes the industry-specific deviation from <span class="math inline">\(\mu + \boldsymbol{x}_{ijkt}^\top \boldsymbol{\beta}\)</span> and <span class="math inline">\(U_{jk}\)</span> denotes the branch-specific deviation from <span class="math inline">\(\mu + \boldsymbol{x}_{ijkt}^\top \boldsymbol{\beta} + U_{j}\)</span>. We assume that the random industry effects <span class="math inline">\(U_j\)</span> are independent and identically distributed (i.i.d.) with <span class="math inline">\(E[U_j] = 0\)</span> and <span class="math inline">\(Var(U_j) = \sigma_{I}^2\)</span>. Similarly, the random branch effects <span class="math inline">\(U_{jk}\)</span> are assumed to be i.i.d. with <span class="math inline">\(E[U_{jk}] = 0\)</span> and <span class="math inline">\(Var(U_{jk}) = \sigma_{B}^2\)</span>.</p>
<p>This package offers three different estimation methods to estimate the model parameters: <br> - Hierarchical credibility model <span class="citation">(Jewell 1975)</span> <br> - Combining the hierarchical credibility model with a GLM <span class="citation">(Ohlsson 2008)</span> <br> - Mixed models <span class="citation">(Molenberghs and Verbeke 2005)</span></p>
</div>
<div class="section level3">
<h3 id="just-the-code-please">Just the code please<a class="anchor" aria-label="anchor" href="#just-the-code-please"></a>
</h3>
<div class="section level4">
<h4 id="example-data-set">Example data set<a class="anchor" aria-label="anchor" href="#example-data-set"></a>
</h4>
<p>To illustrate the functions, we make use of two different data sets. We illustrate the hierarchical credibility model of Jewell <span class="citation">(Jewell 1975)</span> using the Hachemeister <span class="citation">(Hachemeister 1975)</span> data set. The other functions make use of the <code>dataCar</code> data set.</p>
</div>
<div class="section level4">
<h4 id="hierarchical-credibility-model">Hierarchical credibility model<a class="anchor" aria-label="anchor" href="#hierarchical-credibility-model"></a>
</h4>
<p>To estimate the parameters using the hierarchical credibility model, we use the function <code>hierCredibility</code>. By default, the additive hierarchical credibility model <span class="citation">(Dannenburg, Kaas, and Goovaerts 1996)</span> is fit</p>
<p><span class="math display">\[\begin{align*}
        E[Y_{ijkt} | U_j, U_{jk}] &amp;= \mu + U_j + U_{jk}.
\end{align*}\]</span></p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/capture.output.html" class="external-link">capture.output</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://bavodc.github.io/actuaRE/">actuaRE</a></span><span class="op">)</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="co"># suppress startup message</span></span>
<span><span class="co">#&gt; Loading required package: magrittr</span></span>
<span><span class="co">#&gt; Loading required package: speedglm</span></span>
<span><span class="co">#&gt; Loading required package: Matrix</span></span>
<span><span class="co">#&gt; Loading required package: MASS</span></span>
<span><span class="co">#&gt; Loading required package: data.table</span></span>
<span><span class="co">#&gt; Loading required package: ggplot2</span></span>
<span><span class="co">#&gt; Warning: package 'ggplot2' was built under R version 4.1.3</span></span>
<span><span class="co">#&gt; Loading required package: knitr</span></span>
<span><span class="co">#&gt; Package 'actuaRE' version 0.1.0</span></span>
<span><span class="co">#&gt; This is version 0.1.0 of actuaRE</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"hachemeisterLong"</span><span class="op">)</span></span>
<span><span class="va">fitHC</span> <span class="op">=</span> <span class="fu"><a href="../reference/hierCredibility.html">hierCredibility</a></span><span class="op">(</span><span class="va">ratio</span>, <span class="va">weight</span>, <span class="va">cohort</span>, <span class="va">state</span>, <span class="va">hachemeisterLong</span><span class="op">)</span></span>
<span><span class="va">fitHC</span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; hierCredibility(Yijkt = ratio, wijkt = weight, sector = cohort, </span></span>
<span><span class="co">#&gt;     group = state, data = hachemeisterLong)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Additive hierarchical credibility model</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Estimated variance parameters:</span></span>
<span><span class="co">#&gt;   Individual contracts: 139120026 </span></span>
<span><span class="co">#&gt;   Var(V[jk]): 11628.45 </span></span>
<span><span class="co">#&gt;   Var(V[j]): 88476.11 </span></span>
<span><span class="co">#&gt; Unique number of categories of cohort: 2</span></span>
<span><span class="co">#&gt; Unique number of categories of state: 5</span></span></code></pre></div>
<p>To fit the multiplicative hierarchical credibility model <span class="citation">(Ohlsson 2005)</span> <span class="math display">\[\begin{align*}
        E[Y_{ijkt} | \widetilde{U}_j, \widetilde{U}_{jk}] &amp;= \tilde{\mu} \ \widetilde{U}_j \ \widetilde{U}_{jk}
\end{align*}\]</span> you have to specify <code>type = "multiplicative"</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fitHCMult</span> <span class="op">=</span> <span class="fu"><a href="../reference/hierCredibility.html">hierCredibility</a></span><span class="op">(</span><span class="va">ratio</span>, <span class="va">weight</span>, <span class="va">cohort</span>, <span class="va">state</span>, <span class="va">hachemeisterLong</span>, type <span class="op">=</span> <span class="st">"multiplicative"</span><span class="op">)</span></span>
<span><span class="va">fitHCMult</span></span></code></pre></div>
<p>To get a summary of the model fit, we use the <code>summary</code> function.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fitHC</span><span class="op">)</span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; hierCredibility(Yijkt = ratio, wijkt = weight, sector = cohort, </span></span>
<span><span class="co">#&gt;     group = state, data = hachemeisterLong)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Additive hierarchical credibility model</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Estimated variance parameters:</span></span>
<span><span class="co">#&gt;   Individual contracts: 139120026 </span></span>
<span><span class="co">#&gt;   Var(V[jk]): 11628.45 </span></span>
<span><span class="co">#&gt;   Var(V[j]): 88476.11 </span></span>
<span><span class="co">#&gt; Unique number of categories of cohort: 2</span></span>
<span><span class="co">#&gt; Unique number of categories of state: 5 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Estimates at the cohort level:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;    cohort       zj Yjz_BarTilde        qj       Vj        Uj</span></span>
<span><span class="co">#&gt; 1:      1 1.427755     1965.436 0.9157058 1946.859  201.8044</span></span>
<span><span class="co">#&gt; 2:      2 1.633248     1527.011 0.9255216 1543.250 -201.8044</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Estimates at the state level:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;    cohort state    wjk Yjk_BarTilde       zjk      Vjk       Ujk</span></span>
<span><span class="co">#&gt; 1:      1     1 100155     2060.921 0.8932938 2048.750 101.89107</span></span>
<span><span class="co">#&gt; 2:      1     3  13735     1805.843 0.5344614 1871.491 -75.36785</span></span>
<span><span class="co">#&gt; 3:      2     2  19895     1511.224 0.6244749 1523.251 -19.99963</span></span>
<span><span class="co">#&gt; 4:      2     4   4152     1352.976 0.2576359 1494.229 -49.02155</span></span>
<span><span class="co">#&gt; 5:      2     5  36110     1599.829 0.7511373 1585.748  42.49796</span></span></code></pre></div>
<p>To obtain the fitted values, we use the <code>fitted</code> function</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html" class="external-link">fitted</a></span><span class="op">(</span><span class="va">fitHC</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] 2048.750 2048.750 2048.750 2048.750 2048.750 2048.750 2048.750 2048.750</span></span>
<span><span class="co">#&gt;  [9] 2048.750 2048.750 2048.750 2048.750 1871.491 1871.491 1871.491 1871.491</span></span>
<span><span class="co">#&gt; [17] 1871.491 1871.491 1871.491 1871.491 1871.491 1871.491 1871.491 1871.491</span></span>
<span><span class="co">#&gt; [25] 1523.251 1523.251 1523.251 1523.251 1523.251 1523.251 1523.251 1523.251</span></span>
<span><span class="co">#&gt; [33] 1523.251 1523.251 1523.251 1523.251 1494.229 1494.229 1494.229 1494.229</span></span>
<span><span class="co">#&gt; [41] 1494.229 1494.229 1494.229 1494.229 1494.229 1494.229 1494.229 1494.229</span></span>
<span><span class="co">#&gt; [49] 1585.748 1585.748 1585.748 1585.748 1585.748 1585.748 1585.748 1585.748</span></span>
<span><span class="co">#&gt; [57] 1585.748 1585.748 1585.748 1585.748</span></span></code></pre></div>
<p>and we use <code>ranef</code> to extract the estimated random effects.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ranef.html">ranef</a></span><span class="op">(</span><span class="va">fitHC</span><span class="op">)</span></span>
<span><span class="co">#&gt; $sector</span></span>
<span><span class="co">#&gt;    cohort        Uj</span></span>
<span><span class="co">#&gt; 1:      1  201.8044</span></span>
<span><span class="co">#&gt; 2:      2 -201.8044</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $group</span></span>
<span><span class="co">#&gt;    cohort state       Ujk</span></span>
<span><span class="co">#&gt; 1:      1     1 101.89107</span></span>
<span><span class="co">#&gt; 2:      1     3 -75.36785</span></span>
<span><span class="co">#&gt; 3:      2     2 -19.99963</span></span>
<span><span class="co">#&gt; 4:      2     4 -49.02155</span></span>
<span><span class="co">#&gt; 5:      2     5  42.49796</span></span></code></pre></div>
<p>We can inspect the estimated random effects using the function <code>plotRE</code>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ggPlots</span> <span class="op">=</span> <span class="fu"><a href="../reference/plotRE.html">plotRE</a></span><span class="op">(</span><span class="va">fitHC</span>, plot <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">ggPlots</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">ggPlots</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<p><img src="actuaRE_files/figure-html/unnamed-chunk-6-1.png" width="700"><img src="actuaRE_files/figure-html/unnamed-chunk-6-2.png" width="700"></p>
<p>To obtain predictions for a new data frame, we use the <code>predict</code> function.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">newDt</span> <span class="op">=</span> <span class="va">hachemeisterLong</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">hachemeisterLong</span><span class="op">)</span>, <span class="fl">5</span>, <span class="cn">F</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fitHC</span>, <span class="va">newDt</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 2048.750 2048.750 1871.491 1523.251 1585.748</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="combining-the-hierarchical-credibility-model-with-a-glm">Combining the hierarchical credibility model with a GLM<a class="anchor" aria-label="anchor" href="#combining-the-hierarchical-credibility-model-with-a-glm"></a>
</h4>
<p>To allow for company-specific risk factors, we extend the multiplicative hierarchical credibility model to <span class="math display">\[\begin{align*}
        E[Y_{ijkt} | \widetilde{U}_j, \widetilde{U}_{jk}] &amp;= \tilde{\mu} \ \gamma_{ijkt} \ \widetilde{U}_j \ \widetilde{U}_{jk} = \gamma_{ijkt} V_{jk}
\end{align*}\]</span> where <span class="math inline">\(\gamma_{ijkt}\)</span> denotes the effect of the company-specific covariates. To estimate this model using Ohlsson’s GLMC algorithm <span class="citation">(Ohlsson 2008)</span>, we use can either use the function <code>hierCredGLM</code> or <code>hierCredTweedie</code>. <code>hierCredGLM</code> allows the user to specify the power parameter <span class="math inline">\(p\)</span>. Conversely, <code>hierCredTweedie</code> estimates the power parameter <span class="math inline">\(p\)</span> along with the other parameters using the <code>cpglm</code> function from the <code>cplm</code> package.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"dataCar"</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">=</span> <span class="fu">hierCredGLM</span>(Y <span class="sc">~</span> area <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> VehicleType <span class="sc">/</span> VehicleBody), dataCar, <span class="at">weights =</span> w)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>Running algorithm.</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Call:</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; hierCredGLM(formula = Y ~ area + (1 | VehicleType/VehicleBody), </span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     data = dataCar, weights = w)</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Combination of the hierarchical credibility model with a GLM</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Estimated variance parameters:</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Individual contracts: 4288715 </span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Var(V[jk]): 349.22 </span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Var(V[j]): 628.379 </span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Unique number of categories of VehicleType: 2</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Unique number of categories of VehicleBody: 9</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Results contract-specific risk factors:</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Generalized Linear Model of class 'speedglm':</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Call:  speedglm(formula = FormulaGLM, data = data, family = tweedie(var.power = p,      link.power = 0), weights = data$wijkt, model = T, y = T,      fitted = T) </span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Coefficients:</span></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  ------------------------------------------------------------------ </span></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; (Intercept)  5.63582    0.08857 63.6304  0.00000 ***</span></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; areaB        0.04804    0.13070  0.3676  0.71321    </span></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; areaC        0.07686    0.11758  0.6537  0.51333    </span></span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; areaD       -0.18602    0.15779 -1.1789  0.23844    </span></span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; areaE        0.13070    0.16694  0.7829  0.43370    </span></span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; areaF        0.46429    0.18616  2.4941  0.01263 *  </span></span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ------------------------------------------------------------------- </span></span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 </span></span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ---</span></span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; null df: 67565; null deviance: 3314186;</span></span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; residuals df: 67560; residuals deviance: 3298572;</span></span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # obs.: 67566; # non-zero weighted obs.: 67566;</span></span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; AIC: NA; log Likelihood: ;</span></span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; RSS: 66083459; dispersion: 978.1447; iterations: 7;</span></span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; rank: 6; max tolerance: 1.84e-15; convergence: TRUE.</span></span></code></pre></div>
<p>We use the same syntax as used by the package <code>lme4</code> to specify the model formula. Here, <code>(1 | VehicleType / VehicleBody)</code> specifies a random effect <span class="math inline">\(U_j\)</span> for <code>VehicleType</code> and a nested random effect <span class="math inline">\(U_{jk}\)</span> for <code>VehicleBody</code>. We extract the estimated parameters using <code>fixef</code> (company-specific effects) and <code>ranef</code> (random effects).</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/fixef.html">fixef</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="co">#&gt; (Intercept)       areaB       areaC       areaD       areaE       areaF </span></span>
<span><span class="co">#&gt;  5.63581573  0.04803789  0.07686029 -0.18601585  0.13069527  0.46428870</span></span>
<span><span class="fu"><a href="../reference/ranef.html">ranef</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="co">#&gt; $sector</span></span>
<span><span class="co">#&gt;         VehicleType        Uj</span></span>
<span><span class="co">#&gt; 1:   Common vehicle 0.9563139</span></span>
<span><span class="co">#&gt; 2: Uncommon vehicle 1.0514319</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $group</span></span>
<span><span class="co">#&gt;         VehicleType VehicleBody       Ujk</span></span>
<span><span class="co">#&gt; 1:   Common vehicle       HBACK 1.0249732</span></span>
<span><span class="co">#&gt; 2:   Common vehicle       SEDAN 0.9526347</span></span>
<span><span class="co">#&gt; 3:   Common vehicle         UTE 0.9970046</span></span>
<span><span class="co">#&gt; 4: Uncommon vehicle       COUPE 1.0232527</span></span>
<span><span class="co">#&gt; 5: Uncommon vehicle       HDTOP 1.0064355</span></span>
<span><span class="co">#&gt; 6: Uncommon vehicle       MIBUS 1.0041799</span></span>
<span><span class="co">#&gt; 7: Uncommon vehicle       PANVN 1.0023171</span></span>
<span><span class="co">#&gt; 8: Uncommon vehicle       STNWG 0.9833459</span></span>
<span><span class="co">#&gt; 9: Uncommon vehicle       TRUCK 1.0076538</span></span></code></pre></div>
<p>In addition, the same functions as before can be used.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html" class="external-link">fitted</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;        1        2        3        4        5        6 </span></span>
<span><span class="co">#&gt; 296.6857 274.7367 304.5521 240.6055 296.6857 320.2954</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fit</span>, newdata <span class="op">=</span> <span class="va">dataCar</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, <span class="op">]</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span>
<span><span class="co">#&gt;        1        2 </span></span>
<span><span class="co">#&gt; 296.6857 274.7367</span></span>
<span><span class="va">ggPlots</span> <span class="op">=</span> <span class="fu"><a href="../reference/plotRE.html">plotRE</a></span><span class="op">(</span><span class="va">fit</span>, plot <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="mixed-models">Mixed models<a class="anchor" aria-label="anchor" href="#mixed-models"></a>
</h4>
<p>Alternatively, we can rely on the mixed models framework <span class="citation">(Molenberghs and Verbeke 2005)</span> to estimate the model parameters. Here, we can use the  function to estimate a Tweedie generalized linear mixed model. Fitting the model, however, takes quite some time. We can speed up the fitting process by providing some initial estimates and this is exactly what the <code>tweedieGLMM</code> function does! Nonetheless, even with the initial estimates the fitting process does take some time (approximately 5 minutes using Windows 10 with an intel i7 and 32 gigabytes of RAM).</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fitGLMM</span> <span class="op">=</span> <span class="fu"><a href="../reference/tweedieGLMM.html">tweedieGLMM</a></span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="va">area</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">VehicleType</span> <span class="op">/</span> <span class="va">VehicleBody</span><span class="op">)</span>, <span class="va">dataCar</span>, weights <span class="op">=</span> <span class="va">w</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="balance-property">Balance property<a class="anchor" aria-label="anchor" href="#balance-property"></a>
</h4>
<p>For insurance applications, it is crucial that the models provide us a reasonable premium volume at portfolio level. Hereto, we examine the balance property <span class="citation">(Bühlmann and Gisler 2006)</span><span class="citation">(Wüthrich 2020)</span> on the training set. That is, <span class="math display">\[\begin{equation}
    \begin{aligned}
        \sum_{i, j, k, t} w_{ijkt} \ Y_{ijkt} &amp;= \sum_{i, j, k, t} w_{ijkt} \ \widehat{Y}_{ijkt}\\
    \end{aligned}
\end{equation}\]</span> where <span class="math inline">\(i\)</span> serves as an index for the tariff class. GLMs fulfill the balance property when we use the canonical link (see <span class="citation">(Wüthrich 2020)</span>). For LMMs and hence, the hierarchical credibility model this property also holds. Conversely, most GLMMs do not have this property. To regain the balance property, we introduce a quantity <span class="math inline">\(\alpha\)</span> <span class="math display">\[\begin{equation}
    \begin{aligned}
        \alpha &amp;= \frac{\sum_{i, j, k, t} w_{ijkt} \ Y_{ijkt}}{\sum_{i, j, k, t} w_{ijkt} \ \widehat{Y}_{ijkt}}\\
    \end{aligned}
\end{equation}\]</span> which quantifies the deviation of the total predicted damage from the total observed damage. In case of the log link, we can then use <span class="math inline">\(\alpha\)</span> to update the intercept to <span class="math inline">\(\hat{\mu} + \log(\alpha)\)</span> to regain the balance property.</p>
<p>By default, the intercept is updated when fitting models using <code>hierCredGLM</code>, <code>hierCredTweedie</code> and <code>tweedieGLMM</code>. If you do not wish to update the intercept, you can set the argument <code>balanceProperty = FALSE</code>.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>fitnoBP  <span class="ot">=</span> <span class="fu">hierCredGLM</span>(Y <span class="sc">~</span> area <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> VehicleType <span class="sc">/</span> VehicleBody), dataCar, <span class="at">weights =</span> w, <span class="at">balanceProperty =</span> F)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>Running algorithm.</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>yHatnoBP <span class="ot">=</span> <span class="fu">fitted</span>(fitnoBP)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>w        <span class="ot">=</span> <span class="fu">weights</span>(fitnoBP, <span class="st">"prior"</span>)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>y        <span class="ot">=</span> fitnoBP<span class="sc">$</span>y</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>fitBP  <span class="ot">=</span> <span class="fu">hierCredGLM</span>(Y <span class="sc">~</span> area <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> VehicleType <span class="sc">/</span> VehicleBody), dataCar, <span class="at">weights =</span> w, <span class="at">balanceProperty =</span> T)</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>Running algorithm.</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>yHatBP <span class="ot">=</span> <span class="fu">fitted</span>(fitBP)</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(w <span class="sc">*</span> y) <span class="sc">/</span> <span class="fu">sum</span>(w <span class="sc">*</span> yHatnoBP)</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 1.001388</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(w <span class="sc">*</span> y) <span class="sc">/</span> <span class="fu">sum</span>(w <span class="sc">*</span> yHatBP)</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 1</span></span></code></pre></div>
<p>Alternatively, you can use the build-in function <code>BalanceProperty</code>. You can use this function with any object that has the slots <code>fitted</code>, <code>weights</code> and <code>y</code>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/BalanceProperty.html">BalanceProperty</a></span><span class="op">(</span><span class="va">fitnoBP</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in BalanceProperty(fitnoBP): </span></span>
<span><span class="co">#&gt; Balance property is not satisfied.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Ratio total observed damage to total predicted damage: 1.001388</span></span>
<span><span class="fu"><a href="../reference/BalanceProperty.html">BalanceProperty</a></span><span class="op">(</span><span class="va">fitBP</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Balance property is satisfied.</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Buhlmann2005" class="csl-entry">
Bühlmann, H., and A. Gisler. 2006. <em>Course in Credibility Theory and Its Applications</em>. Berlin/Heidelberg: Springer.
</div>
<div id="ref-Dannenburg" class="csl-entry">
Dannenburg, D. R., R. Kaas, and M. J. Goovaerts. 1996. <em>Practical Actuarial Credibility Models</em>. Amsterdam: IAE (Institute of Actuarial Science; Econometrics of the University of Amsterdam).
</div>
<div id="ref-Hachemeister" class="csl-entry">
Hachemeister, C. A. 1975. <span>“Credibility for Regression Models with Application to Trend.”</span> In <em>Credibility, Theory and Applications, Proceedings of the Berkeley Actuarial Research Conference on Credibility</em>, 129–63.
</div>
<div id="ref-JewellModel" class="csl-entry">
Jewell, W. S. 1975. <em>The Use of Collateral Data in Credibility Theory : A Hierarchical Model</em>. International Institute for Applied Systems Analysis. Research Memoranda RM-75-24. Laxenburg: IIASA.
</div>
<div id="ref-Micci2001" class="csl-entry">
Micci-Barreca, D. 2001. <span>“A Preprocessing Scheme for High-Cardinality Categorical Attributes in Classification and Prediction Problems.”</span> <em>SIGKDD Explorations</em> 3 (1): 27–32.
</div>
<div id="ref-Molenberghs2005" class="csl-entry">
Molenberghs, G., and G. Verbeke. 2005. <em>Models for Discrete Longitudinal Data</em>. Springer Series in Statistics. New York, NY: Springer New York.
</div>
<div id="ref-OhlssonJewell" class="csl-entry">
Ohlsson, E. 2005. <em>Simplified Estimation of Structure Parameters in Hierarchical Credibility</em>. Mathematical Statistics, Stockholm University.
</div>
<div id="ref-Ohlsson2008" class="csl-entry">
———. 2008. <span>“Combining Generalized Linear Models and Credibility Models in Practice.”</span> <em>Scandinavian Actuarial Journal</em> 2008 (4): 301–14.
</div>
<div id="ref-Ohlsson" class="csl-entry">
Ohlsson, E., and B. Johansson. 2010. <em>Non-Life Insurance Pricing with Generalized Linear Models</em>. EAA Lecture Notes. Berlin, Heidelberg: Springer Berlin Heidelberg : Imprint: Springer.
</div>
<div id="ref-Wuthrich" class="csl-entry">
Wüthrich, M. V. 2020. <span>“Bias Regularization in Neural Network Models for General Insurance Pricing.”</span> <em>European Actuarial Journal</em> 10 (1): 179–202.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Bavo DC Campo.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.5.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
